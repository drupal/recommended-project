{#
/**
 * @file
 * EDWT override to display a menu.
 *
 * Available variables:
 * - menu_name: The machine name of the menu.
 * - items: A nested list of menu items. Each menu item contains:
 *   - attributes: HTML attributes for the menu item.
 *   - below: The menu item child items.
 *   - title: The menu link title.
 *   - url: The menu link url, instance of \Drupal\Core\Url
 *   - localized_options: Menu link localized options.
 *   - is_expanded: TRUE if the link has visible children within the current
 *     menu tree.
 *   - is_collapsed: TRUE if the link has children within the current menu tree
 *     that are not currently visible.
 *   - in_active_trail: TRUE if the link is in the active trail.
 */
#}
{% import _self as menus %}

{#
  We call a macro which calls itself to render the full tree.
  @see http://twig.sensiolabs.org/doc/tags/macro.html
#}
{{ menus.menu_links(items, attributes, 0) }}

{{ attach_library('edwt/nav') }}

{% macro menu_links(items, attributes, menu_level) %}
  {% import _self as menus %}
  {% if items %}
    {% set ul_classes = [
      menu_level == 0 ? 'nav' : 'dropdown-menu',
    ] %}

    <ul{{attributes.addClass(ul_classes)}}>
      {% for item in items %}
        {% set classes_list = [
            'nav-item',
            item.below ? 'dropdown',
          ] %}
        {% set classes_link = [
            'nav-link',
            'nav-link--level-'~menu_level,
            item.in_active_trail ? 'active',
            item.below ? 'dropdown-toggle',
          ] %}

        <li{{item.attributes.addClass(classes_list)}}>
          {% if item.below %}
            {{ link(item.title, item.url, { 'class': classes_link, 'data-bs-toggle': 'dropdown', 'aria-expanded': 'false'}) }}
            {{ menus.menu_links(item.below, attributes, menu_level + 1) }}
          {% else %}
            {% if item.title == 'Log in' %}
              <a href={{ item.url }} class="nav-link">
                {{- item.title -}}
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4.5 12.75C4.5 13.4475 4.5 13.7962 4.57667 14.0823C4.78472 14.8588 5.3912 15.4653 6.16766 15.6733C6.45378 15.75 6.80252 15.75 7.5 15.75H12.15C13.4101 15.75 14.0402 15.75 14.5215 15.5048C14.9448 15.289 15.289 14.9448 15.5048 14.5215C15.75 14.0402 15.75 13.4101 15.75 12.15V5.85C15.75 4.58988 15.75 3.95982 15.5048 3.47852C15.289 3.05516 14.9448 2.71095 14.5215 2.49524C14.0402 2.25 13.4101 2.25 12.15 2.25H7.5C6.80252 2.25 6.45378 2.25 6.16766 2.32667C5.3912 2.53472 4.78472 3.1412 4.57667 3.91766C4.5 4.20378 4.5 4.55252 4.5 5.25M9 6L12 9M12 9L9 12M12 9H2.25" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            {% else %}
              {{ link(item.title, item.url, { 'class': classes_link }) }}
            {% endif %}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}
